<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>Ë≤∏Âá∫Êõ∏Á±çÊ§úÁ¥¢„Ç∑„Çπ„ÉÜ„É†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap');

      /* --- General Styles --- */
      body {
        font-family: 'Noto Sans JP', sans-serif;
        background: linear-gradient(135deg, #f5f1e8 0%, #e8dfd2 100%);
        color: #2c3e50;
        margin: 0;
        padding: 0;
        line-height: 1.7;
        font-size: 48px;
        -webkit-text-size-adjust: 100%;
        min-height: 100vh;
        position: relative;
      }
      
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          repeating-linear-gradient(
            45deg,
            transparent,
            transparent 35px,
            rgba(139, 111, 78, 0.03) 35px,
            rgba(139, 111, 78, 0.03) 70px
          );
        pointer-events: none;
        z-index: 1;
      }
      
      .container {
        position: relative;
        z-index: 2;
        margin: 0;
        padding: 45px;
        background-color: rgba(255, 255, 255, 0.95);
        width: 100%;
        min-height: 100vh;
        box-sizing: border-box;
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
      }
      
      h1 {
        color: #8b6f4e;
        margin-top: 0;
        text-align: center;
        margin-bottom: 90px;
        border-bottom: 6px solid #d4af37;
        padding-bottom: 60px;
        font-size: 72px;
        font-family: 'Noto Serif JP', serif;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
      }
      
      h1::before {
        content: "üîç";
        display: block;
        font-size: 48px;
        margin-bottom: 20px;
      }
      
      h2 {
        margin-top: 120px;
        text-align: left;
        border-bottom: 4px solid #d4af37;
        font-size: 60px;
        color: #8b6f4e;
        padding-left: 30px;
        padding-right: 30px;
        padding-bottom: 30px;
        font-family: 'Noto Serif JP', serif;
      }

      /* --- Form Styles --- */
      .form-group {
        margin-bottom: 90px;
        background: rgba(255, 255, 255, 0.7);
        padding: 45px;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      }
      
      label {
        display: block;
        margin-bottom: 45px;
        font-weight: 700;
        color: #8b6f4e;
        font-size: 54px;
        font-family: 'Noto Serif JP', serif;
        position: relative;
        padding-left: 60px;
      }
      
      label::before {
        content: "‚ñ∏";
        position: absolute;
        left: 0;
        color: #d4af37;
        font-size: 48px;
      }
      
      input[type="text"], input[type="number"] {
        width: 100%;
        padding: 45px;
        border: 3px solid #d4af37;
        border-radius: 24px;
        box-sizing: border-box;
        font-size: 48px;
        font-family: 'Noto Sans JP', sans-serif;
        -webkit-appearance: none;
        appearance: none;
        background: rgba(255, 255, 255, 0.9);
        transition: all 0.3s ease;
      }
      
      input[type="text"]:focus, input[type="number"]:focus {
        outline: none;
        border-color: #8b6f4e;
        box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
      }
      
      input[readonly] {
        background-color: #f5f1e8;
        cursor: not-allowed;
        border-color: #e8dfd2;
      }
      
      /* „Ç´„É°„É©Âàá„ÇäÊõø„Åà„Éú„Çø„É≥ */
      .camera-switch-btn {
        background-color: #8b6f4e;
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 36px;
        border-radius: 10px;
        cursor: pointer;
        margin-right: 20px;
      }
      
      .camera-switch-btn:hover {
        background-color: #6d5640;
      }
      
      /* Âü∫Êú¨„Éú„Çø„É≥„Çπ„Çø„Ç§„É´ */
      button {
        color: white;
        padding: 45px 60px;
        border: none;
        border-radius: 24px;
        cursor: pointer;
        font-size: 48px;
        font-weight: 700;
        transition: all 0.3s ease;
        margin-top: 45px;
        font-family: 'Noto Sans JP', sans-serif;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        min-height: 132px;
        background: linear-gradient(135deg, #8b6f4e 0%, #6d5a3f 100%);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
      }
      
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      }
      
      button:active {
        transform: translateY(0);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }
      
      button:disabled {
        background: linear-gradient(135deg, #cccccc 0%, #999999 100%);
        color: #666666;
        cursor: not-allowed;
        opacity: 0.7;
        box-shadow: none;
        transform: none;
      }
      
      /* „Çπ„Ç≠„É£„É≥„Éú„Çø„É≥ */
      #scan-book-id-button {
        padding: 36px 60px;
        background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        margin-right: 30px;
        font-size: 48px;
        font-weight: 400;
      }
      
      #scan-book-id-button:hover {
        background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
      }
      
      /* Ê§úÁ¥¢„Éú„Çø„É≥ */
      button[onclick="searchRentalRecords()"] {
        margin-top: 60px;
        font-weight: 400;
        padding: 45px 60px;
        font-size: 48px;
        width: 100%;
        min-height: 150px;
        background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
      }
      
      button[onclick="searchRentalRecords()"]:hover {
        background: linear-gradient(135deg, #b8941f 0%, #9c7d1a 100%);
      }


      /* --- Scanner Container --- */
      /* „Çπ„Ç≠„É£„Éä„Éº„Ç≥„É≥„ÉÜ„ÉäÂÖ®‰Ωì */
      .scanner-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #000;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      /* „Çπ„Ç≠„É£„Éä„Éº„Éò„ÉÉ„ÉÄ„Éº */
      .scanner-header {
        position: absolute;
        top: 0;
        right: 0;
        padding: 20px;
        z-index: 1002;
      }

      .close-scanner-btn {
        background-color: #8b6f4e;
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 36px;
        border-radius: 10px;
        cursor: pointer;
      }
      
      .close-scanner-btn:hover {
        background-color: #6d5640;
      }

      /* „Çπ„Ç≠„É£„Éä„Éº„Éì„É•„Éº„Éù„Éº„Éà */
      .scanner-viewport {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #000;
      }

      /* Quagga„ÅÆË¶ÅÁ¥†„ÇíÂà∂Âæ° */
      .scanner-viewport canvas,
      .scanner-viewport video {
        position: absolute !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: cover !important;
      }

      /* ‰∏çË¶Å„Å™Ë¶ÅÁ¥†„ÇíÂÆåÂÖ®„Å´ÂâäÈô§ */
      .scanner-viewport br,
      .scanner-viewport .drawingBuffer,
      .scanner-viewport canvas:not(:last-child) {
        display: none !important;
      }

      /* „Çπ„Éû„ÉõÂØæÂøú */
      @media (max-width: 768px) {
        .scanner-viewport {
          width: 100%;
          height: 100%;
        }
        
        .close-scanner-btn {
          font-size: 24px;
          padding: 10px 20px;
        }
      }


      /* --- Results Area --- */
      #rental-records {
        margin-top: 90px;
        background: rgba(255, 255, 255, 0.7);
        padding: 45px;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      }
      #records-container {
        overflow-x: auto;
      }
      /* ËøîÂç¥Áä∂Ê≥Å„ÅÆËâ≤ÂàÜ„Åë */
      .status-returned {
        color: #28a745;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }
      .status-not-returned {
        color: #dc3545;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }
      /* Âà©Áî®ËÄÖIDË°®Á§∫Áî® */
      .user-id {
        display: block;
        font-size: 0.85em;
        color: #8b6f4e;
        margin-top: 15px;
        font-style: italic;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 60px;
        font-size: 48px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      th, td {
        padding: 45px;
        text-align: left;
        border-bottom: 3px solid #e8dfd2;
      }
      th {
        background: linear-gradient(135deg, #8b6f4e 0%, #6d5a3f 100%);
        color: #ffffff;
        font-weight: 700;
        white-space: nowrap;
        font-family: 'Noto Serif JP', serif;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
      }
      tr:nth-child(even) {
        background-color: rgba(245, 241, 232, 0.3);
      }
      tr:hover {
        background-color: rgba(212, 175, 55, 0.1);
        transition: background-color 0.3s ease;
      }
      .no-records {
        font-style: italic;
        color: #8b6f4e;
        text-align: center;
        padding: 75px;
        font-size: 3.3em;
        font-family: 'Noto Serif JP', serif;
      }


      /* --- Message Area --- */
      #message {
        margin-top: 90px;
        font-weight: 700;
        padding: 45px;
        border-radius: 24px;
        text-align: center;
        font-size: 48px;
        font-family: 'Noto Sans JP', sans-serif;
      }
      /* „É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÁ®ÆÈ°û„Å´Âøú„Åò„Å¶„Çπ„Çø„Ç§„É´„ÇíÂ§â„Åà„Çã */
      #message:not(:empty) {
        display: block;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.2) 100%);
        border: 3px solid #d4af37;
        color: #8b6f4e;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      /* --- Responsive Design --- */
      @media (max-width: 768px) { /* „ÉÜ„Éº„Éñ„É´„Åå„ÅÇ„Çã„ÅÆ„Åß„Éñ„É¨„Éº„ÇØ„Éù„Ç§„É≥„ÉàË™øÊï¥ */
        /* .container „ÅÆË™øÊï¥„ÅØ‰∏ã„ÅÆ 600px „ÅßË°å„ÅÜ */
        th, td {
            padding: 36px 30px; /* „Çπ„Éû„Éõ„Åß„ÅØ„ÉÜ„Éº„Éñ„É´„Éë„Éá„Ç£„É≥„Ç∞„Çí3ÂÄç„Å´Êã°Â§ß */
            font-size: 3.3em; /* „Çπ„Éû„Éõ„Åß„ÅØ„ÉÜ„Éº„Éñ„É´ÊñáÂ≠ó„Çµ„Ç§„Ç∫„Çí3ÂÄç„Å´Êã°Â§ß */
        }
      }
      @media (max-width: 600px) {
         .container {
             padding: 30px; /* „Çπ„Éû„Éõ„Åß„ÅØ„Ç≥„É≥„ÉÜ„ÉäÂÜÖ„Éë„Éá„Ç£„É≥„Ç∞„Çí3ÂÄç„Å´Êã°Â§ß */
         }
        h1 {
          font-size: 66px; /* 3ÂÄç„Å´Êã°Â§ß */
          padding-left: 15px; /* 3ÂÄç„Å´Êã°Â§ß */
          padding-right: 15px; /* 3ÂÄç„Å´Êã°Â§ß */
        }
        .form-group {
            padding-left: 15px; /* 3ÂÄç„Å´Êã°Â§ß */
            padding-right: 15px; /* 3ÂÄç„Å´Êã°Â§ß */
        }
        #rental-records {
             padding-left: 15px; /* 3ÂÄç„Å´Êã°Â§ß */
             padding-right: 15px; /* 3ÂÄç„Å´Êã°Â§ß */
        }
        #message {
            margin-left: 15px; /* 3ÂÄç„Å´Êã°Â§ß */
            margin-right: 15px; /* 3ÂÄç„Å´Êã°Â§ß */
            font-size: 45px; /* 3ÂÄç„Å´Êã°Â§ß */
        }
        button {
          width: 100%; /* Â∞èÁîªÈù¢„Åß„ÅØ„Éú„Çø„É≥ÂπÖ„Çí100%„Å´ */
          margin-right: 0;
          margin-bottom: 30px; /* „Éú„Çø„É≥Èñì„ÅÆÁ∏¶„Çπ„Éö„Éº„Çπ„Çí3ÂÄç„Å´Êã°Â§ß */
          padding: 45px; /* 3ÂÄç„Å´Êã°Â§ß */
          font-size: 48px; /* 3ÂÄç„Å´Êã°Â§ß */
          min-height: 150px; /* „Çø„ÉÉ„ÉÅ„Çø„Éº„Ç≤„ÉÉ„Éà„Çí3ÂÄç„Å´Êã°Â§ß */
        }
         #scan-book-id-button { /* ID‰øÆÊ≠£ */
             margin-bottom: 30px; /* „Çπ„Ç≠„É£„É≥„Éú„Çø„É≥‰∏ã„ÅÆ„Çπ„Éö„Éº„Çπ„Çí3ÂÄç„Å´Êã°Â§ß */
             padding: 45px; /* 3ÂÄç„Å´Êã°Â§ß */
         }
         button:last-of-type {
             margin-bottom: 0;
         }
         
         /* „ÉÜ„Éº„Éñ„É´„ÅÆ„É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú„ÇíÂº∑Âåñ */
         table, thead, tbody, th, td, tr {
             display: block;
         }
         
         /* „Éò„ÉÉ„ÉÄ„Éº„ÇíÈùûË°®Á§∫ */
         thead tr {
             position: absolute;
             top: -9999px;
             left: -9999px;
         }
         
         tr {
             margin-bottom: 45px; /* 3ÂÄç„Å´Êã°Â§ß */
             border: 3px solid #ccc; /* 3ÂÄç„Å´Êã°Â§ß */
             border-radius: 24px; /* 3ÂÄç„Å´Êã°Â§ß */
             background-color: #fff;
         }
         
         td {
             /* td„Çí„Éñ„É≠„ÉÉ„ÇØË¶ÅÁ¥†„Å®„Åó„Å¶Ë°®Á§∫„Åó„ÄÅÂêÑ„Çª„É´„ÅÆÂâç„Å´„É©„Éô„É´„ÇíË°®Á§∫ */
             position: relative;
             padding-left: 50%;
             border: none;
             border-bottom: 3px solid #eee; /* 3ÂÄç„Å´Êã°Â§ß */
         }
         
         td:before {
             /* „É©„Éô„É´„Å®„Åó„Å¶‰ΩøÁî®„Åô„Çã„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
             position: absolute;
             top: 45px; /* 3ÂÄç„Å´Êã°Â§ß */
             left: 45px; /* 3ÂÄç„Å´Êã°Â§ß */
             width: 45%;
             padding-right: 30px; /* 3ÂÄç„Å´Êã°Â§ß */
             white-space: nowrap;
             font-weight: bold;
         }
         
         /* ÂêÑ„Çª„É´„ÅÆ„É©„Éô„É´ */
         td:nth-of-type(1):before { content: "Êõ∏Á±çID"; }
         td:nth-of-type(2):before { content: "Êõ∏Á±çÂêç"; }
         td:nth-of-type(3):before { content: "Âà©Áî®ËÄÖÂêç"; }
         td:nth-of-type(4):before { content: "Ë≤∏Âá∫Êó•ÊôÇ"; }
         td:nth-of-type(5):before { content: "ËøîÂç¥‰∫àÂÆöÊó•"; }
         td:nth-of-type(6):before { content: "ËøîÂç¥Áä∂Ê≥Å"; }
      }
      /* --- Menu Button --- */
      .menu-button {
        background: linear-gradient(135deg, #8b6f4e 0%, #6d5640 100%);
        color: white;
        padding: 30px 60px;
        font-size: 48px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 15px;
        margin: 30px 0;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        font-weight: 700;
      }
      
      .menu-button:hover {
        background: linear-gradient(135deg, #6d5640 0%, #5a4635 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      }
      .menu-button-container {
        text-align: center;
        margin: 30px 0;
        position: relative;
        z-index: 3;
      }
    </style>
  </head>
  <body>
    <div class="menu-button-container"><a href="#" class="menu-button" id="menu-button-top">‚Üê „É°„Éã„É•„Éº„Å´Êàª„Çã</a></div>
    <div class="container">
      <h1>Ë≤∏Âá∫Êõ∏Á±çÊ§úÁ¥¢</h1>

      <div class="form-group">
        <label for="book-id">Ê§úÁ¥¢„Åô„ÇãÊõ∏Á±çID</label>
        <button id="scan-book-id-button">Êõ∏Á±çID„Çí„Çπ„Ç≠„É£„É≥</button>
        <input type="text" id="book-id" name="bookId" placeholder="„Çπ„Ç≠„É£„É≥„Åô„Çã„ÅãÊâãÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ">
        <div id="scanner-container-finder" class="scanner-container" style="display: none;">
          <div class="scanner-header">
            <button class="camera-switch-btn" onclick="switchCamera('interactive')">ÂàáÊõø</button>
            <button class="close-scanner-btn" onclick="closeScanner('interactive')">‚úï Èñâ„Åò„Çã</button>
          </div>
          <div id="interactive" class="scanner-viewport"></div>
        </div>
      </div>

      <button class="btn-utility" onclick="searchRentalRecords()">Ê§úÁ¥¢</button>
      <p id="message"></p>

      <div id="rental-records" style="display: none;">
        <h2>Ê§úÁ¥¢ÁµêÊûú</h2>
        <div id="records-container"></div>
      </div>
      
      <!-- „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Ë°®Á§∫„Ç®„É™„Ç¢„ÇíÂâäÈô§ -->
    </div>

    <!-- „Éê„Éº„Ç≥„Éº„ÉâË™≠„ÅøÂèñ„Çä„É©„Ç§„Éñ„É©„É™ (QuaggaJS„Çí‰ΩøÁî®) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script>
      let isScanning = false;
      let currentFacingMode = "environment"; // „Ç´„É°„É©„ÅÆÂêë„ÅçÔºàenvironment: „Ç¢„Ç¶„Éà„Ç´„É°„É©„ÄÅuser: „Ç§„É≥„Ç´„É°„É©Ôºâ
      // Web Audio API„Çí‰ΩøÁî®„Åó„Åü„Éì„Éº„ÉóÈü≥ÁîüÊàêÈñ¢Êï∞
      function playBeepSound() {
        try {
          // Web Audio API„Çí‰ΩøÁî®„Åó„Å¶„Éì„Éº„ÉóÈü≥„ÇíÁîüÊàê
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          oscillator.frequency.value = 800; // 800Hz„ÅÆ„Éì„Éº„ÉóÈü≥
          oscillator.type = 'sine';
          
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
          
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.1);
        } catch (e) {
          console.log('„Éì„Éº„ÉóÈü≥„ÅÆÂÜçÁîü„Çí„Çπ„Ç≠„ÉÉ„Éó:', e);
        }
      }

      // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÊôÇ„ÅÆÂá¶ÁêÜ
      window.onload = function() {
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
      };

      // „Çπ„Ç≠„É£„É≥„Éú„Çø„É≥„ÅÆÂá¶ÁêÜ
      document.getElementById('scan-book-id-button').addEventListener('click', () => {
        toggleScanner('interactive', 'book-id');
      });

      // „Çπ„Ç≠„É£„Éä„Éº„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà„ÇãÈñ¢Êï∞
      function toggleScanner(viewportId, inputFieldId) {
        const containerId = 'scanner-container-finder';
        const container = document.getElementById(containerId);
        
        if (container.style.display === 'none') {
          container.style.display = 'flex';
          startScanner(viewportId, inputFieldId);
        } else {
          closeScanner(viewportId);
        }
      }

      function closeScanner(viewportId) {
        const containerId = 'scanner-container-finder';
        const container = document.getElementById(containerId);
        container.style.display = 'none';
        stopScanner(viewportId);
      }

      function startScanner(targetElementId, inputFieldId) {
        setMessage("„Ç´„É°„É©„ÇíËµ∑Âãï„Åó„Å¶„ÅÑ„Åæ„Åô...");
        
        // Êó¢Â≠ò„ÅÆQuagga„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÇíÂÅúÊ≠¢
        if (typeof Quagga !== 'undefined' && Quagga._handler) {
          Quagga.stop();
        }
        
        // „Éì„É•„Éº„Éù„Éº„Éà„ÇíÂÆåÂÖ®„Å´„ÇØ„É™„Ç¢
        const viewport = document.getElementById(targetElementId);
        if (viewport) {
          viewport.innerHTML = '';
          viewport.style.cssText = ''; // „Åô„Åπ„Å¶„ÅÆ„Ç§„É≥„É©„Ç§„É≥„Çπ„Çø„Ç§„É´„Çí„ÇØ„É™„Ç¢
        }

        // Quagga„ÅåÁîüÊàê„Åó„ÅüÂèØËÉΩÊÄß„ÅÆ„ÅÇ„ÇãË¶ÅÁ¥†„Çí„Ç∞„É≠„Éº„Éê„É´„Å´ÂâäÈô§
        document.querySelectorAll('.drawingBuffer').forEach(el => el.remove());
        
        isScanning = true;
        
        // ÂàùÊúüÂåñ„ÇíÈÅÖÂª∂ÂÆüË°å
        setTimeout(() => {
          initializeScanner(targetElementId, inputFieldId);
        }, 300); // „Çπ„Éû„Éõ„Åß„ÅØÂ∞ë„ÅóÈï∑„ÇÅ„Å´ÂæÖÊ©ü
      }
      
      function initializeScanner(targetElementId, inputFieldId) {
        // „Éá„Éê„Ç§„ÇπÂà§ÂÆö
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        Quagga.init({
          inputStream : {
            name : "Live",
            type : "LiveStream",
            target: document.querySelector(`#${targetElementId}`),
            constraints: {
              width: { min: 640, ideal: isMobile ? 1280 : 1920, max: 1920 },
              height: { min: 480, ideal: isMobile ? 720 : 1080, max: 1080 },
              facingMode: currentFacingMode,
              aspectRatio: isMobile ? { ideal: 16/9 } : undefined
            },
            area: isMobile ? { top: "0%", right: "0%", left: "0%", bottom: "0%" } : undefined
          },
          locator: {
            patchSize: isMobile ? "large" : "medium",
            halfSample: !isMobile
          },
          numOfWorkers: isMobile ? 2 : 4,
          frequency: isMobile ? 5 : 10,
          decoder : { 
            readers : [          // Ë§áÊï∞„ÅÆ„Éê„Éº„Ç≥„Éº„Éâ„É™„Éº„ÉÄ„Éº„ÇíÊúâÂäπÂåñ
              'code_128_reader',
              'code_39_reader',
              'ean_reader',
              'ean_8_reader',
              'code_93_reader'
            ],
            multiple: false      // Ë§áÊï∞„ÅÆ„Éê„Éº„Ç≥„Éº„Éâ„ÇíÂêåÊôÇ„Å´Ë™≠„ÅøÂèñ„Çâ„Å™„ÅÑ
          },
          locate: true
        }, function(err) {
            if (err) {
                console.error(err);
                setMessage(`„Çπ„Ç≠„É£„Éä„Éº„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó: ${err.name}. „Ç´„É°„É©„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);
                document.getElementById(targetElementId).style.display = 'none';
                isScanning = false;
                return;
            }
            console.log("„Çπ„Ç≠„É£„Éä„ÉºÂàùÊúüÂåñÂÆå‰∫Ü");
            setMessage("„Éê„Éº„Ç≥„Éº„Éâ„Çí„Ç´„É°„É©„Å´Âêë„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
            Quagga.start();
        });

        // onProcessed„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ„ÇíÂâäÈô§„Åó„Å¶„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÈùûË°®Á§∫

        // ÈáçË§áÈò≤Ê≠¢„ÅÆ„Åü„ÇÅ„ÅÆ„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Å®ÂâçÂõû„ÅÆ„Ç≥„Éº„Éâ
        let lastDetectedTime = 0;
        let lastDetectedCode = null;
        const COOLDOWN_PERIOD = 3000; // Âêå„Åò„Ç≥„Éº„Éâ„ÇíÂÜçÊ§úÂá∫„Åô„Çã„Åæ„Åß„ÅÆÂæÖÊ©üÊôÇÈñìÔºà„Éü„É™ÁßíÔºâ
        
        Quagga.onDetected(function(result) {
          // „Çπ„Ç≠„É£„Éä„Éº„ÅåÂÅúÊ≠¢„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÂá¶ÁêÜ„Åó„Å™„ÅÑ
          if (!isScanning) {
            console.log("„Çπ„Ç≠„É£„Éä„Éº„ÅØÊó¢„Å´ÂÅúÊ≠¢„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Ç§„Éô„É≥„Éà„ÇíÁÑ°Ë¶ñ„Åó„Åæ„Åô„ÄÇ");
            return;
          }
          
          const code = result.codeResult.code;
          const currentTime = new Date().getTime();
          console.log("„Éê„Éº„Ç≥„Éº„ÉâÊ§úÂá∫:", code, "‰ø°È†ºÂ∫¶:", result.codeResult.confidence);
          
          // ‰ø°È†ºÂ∫¶„Åå‰Ωé„ÅÑÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„ÉóÔºàÈñæÂÄ§„Çí‰∏ã„Åí„Å¶Ê§úÂá∫ÁéáÂêë‰∏äÔºâ
          if (result.codeResult.confidence < 0.5) {
            console.log("‰ø°È†ºÂ∫¶„Åå‰Ωé„ÅÑ„Åü„ÇÅÁÑ°Ë¶ñ„Åó„Åæ„Åô:", result.codeResult.confidence);
            return;
          }
          
          // ÂâçÂõû„Å®Âêå„Åò„Ç≥„Éº„Éâ„Åß„ÄÅ„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥ÊúüÈñìÂÜÖ„ÅÆÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó
          if (code === lastDetectedCode && (currentTime - lastDetectedTime) < COOLDOWN_PERIOD) {
            console.log(`Âêå„Åò„Ç≥„Éº„Éâ„ÅåÁü≠ÊôÇÈñì„ÅßÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü„ÄÇÁÑ°Ë¶ñ„Åó„Åæ„Åô„ÄÇÁµåÈÅéÊôÇÈñì: ${currentTime - lastDetectedTime}ms`);
            return;
          }
          
          // Êñ∞„Åó„ÅÑ„Ç≥„Éº„Éâ„Å®„Åó„Å¶Âá¶ÁêÜ
          lastDetectedCode = code;
          lastDetectedTime = currentTime;
          
          document.getElementById(inputFieldId).value = code;
          setMessage(`„Ç≥„Éº„Éâ„Äå${code}„Äç„ÇíË™≠„ÅøÂèñ„Çä„Åæ„Åó„Åü„ÄÇ`);
          
          // „Éì„Éº„ÉóÈü≥„ÇíÂÜçÁîü
          playBeepSound();
          
          closeScanner(targetElementId);
          searchRentalRecords(); // Êõ∏Á±çID„ÅåË™≠„ÅøÂèñ„Çå„Åü„ÇâËá™ÂãïÁöÑ„Å´Ê§úÁ¥¢
        });
      }

      function stopScanner(viewportId) {
        // Quagga„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        if (typeof Quagga !== 'undefined' && Quagga._handler && Quagga._handler.inputStream) {
          try {
            // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº„Çí„ÇØ„É™„Ç¢
            Quagga.offProcessed();
            Quagga.offDetected();
            Quagga.stop();
          } catch (e) {
            console.log('Quagga.stop() „Ç®„É©„ÉºÔºàÁÑ°Ë¶ñÂèØËÉΩÔºâ:', e);
          }
        }
        
        // „Éì„É•„Éº„Éù„Éº„Éà„ÇíÂÆåÂÖ®„Å´„ÇØ„É™„Ç¢
        const viewport = document.getElementById(viewportId);
        if (viewport) {
          // „Åô„Åπ„Å¶„ÅÆÂ≠êË¶ÅÁ¥†„ÇíÂº∑Âà∂ÁöÑ„Å´ÂâäÈô§
          while (viewport.firstChild) {
            viewport.removeChild(viewport.firstChild);
          }
          
          // „Ç§„É≥„É©„Ç§„É≥„Çπ„Çø„Ç§„É´„ÇíÂÆåÂÖ®„Å´„É™„Çª„ÉÉ„Éà
          viewport.removeAttribute('style');
          viewport.style.display = 'none';
          
          // Quagga„ÅåÁîüÊàê„Åó„ÅüÂèØËÉΩÊÄß„ÅÆ„ÅÇ„ÇãË¶ÅÁ¥†„Çí„Ç∞„É≠„Éº„Éê„É´„Å´Ê§úÁ¥¢„Åó„Å¶ÂâäÈô§
          document.querySelectorAll('.drawingBuffer').forEach(el => el.remove());
        }
        
        // „Çπ„Ç≠„É£„Éä„Éº„Ç≥„É≥„ÉÜ„ÉäÂÜÖ„ÅÆ„Åô„Åπ„Å¶„ÅÆcanvasË¶ÅÁ¥†„ÇíÂâäÈô§
        const container = document.getElementById('scanner-container-finder');
        if (container) {
          container.querySelectorAll('canvas').forEach(el => el.remove());
          container.querySelectorAll('video').forEach(el => el.remove());
        }
        
        // „Çπ„Ç≠„É£„É≥Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
        isScanning = false;
      }

      // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Èñ¢ÈÄ£„ÅÆÈñ¢Êï∞„ÇíÂâäÈô§„Åó„ÄÅÁ©∫„ÅÆÈñ¢Êï∞„Å´ÁΩÆ„ÅçÊèõ„Åà
      function addLog(message) {
        // „Ç≥„É≥„ÇΩ„Éº„É´„Å´„ÅÆ„ÅøÂá∫ÂäõÔºàÈñãÁô∫ÊôÇ„ÅÆ„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
        console.log(message);
      }

      // Ë≤∏Âá∫Ë®òÈå≤„ÇíÊ§úÁ¥¢„Åô„ÇãÈñ¢Êï∞
      function searchRentalRecords() {
        const bookId = document.getElementById('book-id').value.trim();
        if (!bookId) {
          setMessage("Êõ∏Á±çID„ÇíÂÖ•Âäõ„Åæ„Åü„ÅØ„Çπ„Ç≠„É£„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
          return;
        }

        setMessage("Ë≤∏Âá∫Ë®òÈå≤„ÇíÊ§úÁ¥¢‰∏≠...");
        document.getElementById('rental-records').style.display = 'none';
        document.getElementById('records-container').innerHTML = '';
        
        // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
        
        google.script.run
          .withSuccessHandler((result) => {
            console.log("Ê§úÁ¥¢ÁµêÊûú:", result); // „Éá„Éê„ÉÉ„Ç∞Áî®
            // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
            
            // --- ÁµêÊûúÂá¶ÁêÜ„É≠„Ç∏„ÉÉ„ÇØ„ÅÆÊîπÂñÑ ---
            let recordsToDisplay = [];
            let foundViaRecords = false;
            let foundViaLogs = false;

            // 1. result „Å® result.records „ÅåÊ≠£Â∏∏„Å´Â≠òÂú®„Åô„Çã„ÅãÁ¢∫Ë™ç
            if (result && result.records && Array.isArray(result.records) && result.records.length > 0) {
              recordsToDisplay = result.records;
              foundViaRecords = true;
              // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
            } else {
              // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
              // 2. records „Åå„ÉÄ„É°„Å™„Çâ„ÄÅlogs „Åã„Çâ„ÄåË≤∏Âá∫Ë®òÈå≤Áô∫Ë¶ã„Äç„ÇíÊé¢„Åô
              if (result && result.logs && Array.isArray(result.logs)) {
                for (const log of result.logs) {
                  if (log.includes("Ë≤∏Âá∫Ë®òÈå≤Áô∫Ë¶ã")) {
                    foundViaLogs = true;
                    // „É≠„Ç∞„Åã„ÇâÊÉÖÂ†±„ÇíÊäΩÂá∫„Åó„Å¶„ÉÄ„Éü„Éº„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàê
                    const match = log.match(/Ë≤∏Âá∫Ë®òÈå≤Áô∫Ë¶ã \(Ë°å \d+\): (.*), (.*), Áä∂ÊÖã=(.*)/);
                    if (match) {
                      const bookTitle = match[1];
                      const userName = match[2];
                      const status = match[3];
                      
                      // „ÉÄ„Éü„Éº„É¨„Ç≥„Éº„Éâ„ÇíËøΩÂä† (Êó•‰ªò„ÅØÊñáÂ≠óÂàó„Å®„Åó„Å¶Êâ±„ÅÜ)
                      recordsToDisplay.push({
                        bookId: bookId,
                        bookTitle: bookTitle,
                        userName: userName,
                        lendingDate: "Ôºà„É≠„Ç∞„Åã„ÇâÂæ©ÂÖÉÔºâ", // „ÉÄ„Éü„Éº„Éá„Éº„Çø„ÇíÁ§∫„Åô
                        dueDate: "Ôºà„É≠„Ç∞„Åã„ÇâÂæ©ÂÖÉÔºâ",     // „ÉÄ„Éü„Éº„Éá„Éº„Çø„ÇíÁ§∫„Åô
                        status: status
                      });
                      // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
                    }
                  }
                }
                if (foundViaLogs && recordsToDisplay.length === 0) {
                    // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
                }
              } else {
                  // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
              }
            }

            // 3. Ë°®Á§∫Âá¶ÁêÜ
            if (recordsToDisplay.length > 0) {
              displayRentalRecords(recordsToDisplay);
              setMessage(`Êõ∏Á±çID [${bookId}] „ÅÆË≤∏Âá∫Ë®òÈå≤„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü„ÄÇ${foundViaRecords ? '' : ' („É≠„Ç∞„Åã„ÇâÂæ©ÂÖÉ)'}`);
              // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
            } else {
              // records„Å´„ÇÇlogs„Å´„ÇÇÊÉÖÂ†±„Åå„Å™„Åã„Å£„ÅüÂ†¥Âêà
              setMessage(`Êõ∏Á±çID [${bookId}] „ÅÆË≤∏Âá∫Ë®òÈå≤„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ`);
              document.getElementById('rental-records').style.display = 'block';
              document.getElementById('records-container').innerHTML = '<p class="no-records">Ë©≤ÂΩì„Åô„ÇãË≤∏Âá∫Ë®òÈå≤„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
              // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
            }
            // --- ÁµêÊûúÂá¶ÁêÜ„É≠„Ç∏„ÉÉ„ÇØ„Åì„Åì„Åæ„Åß ---
          })
          .withFailureHandler(function(error) {
            // Failure Handler„ÅåÂëº„Å∞„Çå„ÅüÂ†¥Âêà„ÇÇÊòéÁ¢∫„Å´„É≠„Ç∞Âá∫Âäõ
            setMessage(`Ê§úÁ¥¢„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}`);
            // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
            console.error("„Çµ„Éº„Éê„ÉºÂëº„Å≥Âá∫„Åó„Ç®„É©„Éº:", error);
            // „Ç®„É©„ÉºÊôÇ„ÇÇ„ÄåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄçË°®Á§∫„ÇíÂá∫„Åô
            document.getElementById('rental-records').style.display = 'block';
            document.getElementById('records-container').innerHTML = '<p class="no-records">Ê§úÁ¥¢‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ</p>';
          })
          .findRentalRecords(bookId);
      }

      // Ë≤∏Âá∫Ë®òÈå≤„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
      function displayRentalRecords(records) {
        console.log("Ë°®Á§∫„Åô„ÇãË≤∏Âá∫Ë®òÈå≤:", records); // „Éá„Éê„ÉÉ„Ç∞Áî®
        // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞Âá∫Âäõ„ÇíÂâäÈô§
        
        const container = document.getElementById('records-container');
        
        // „ÉÜ„Éº„Éñ„É´„Çí‰ΩúÊàê
        let html = `
          <table>
            <thead>
              <tr>
                <th>Êõ∏Á±çID</th>
                <th>Êõ∏Á±çÂêç</th>
                <th>Âà©Áî®ËÄÖÂêç</th>
                <th>Ë≤∏Âá∫Êó•ÊôÇ</th>
                <th>ËøîÂç¥‰∫àÂÆöÊó•</th>
                <th>ËøîÂç¥Áä∂Ê≥Å</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        // „É¨„Ç≥„Éº„Éâ„Åî„Å®„Å´Ë°å„ÇíËøΩÂä†
        records.forEach(record => {
          console.log("„É¨„Ç≥„Éº„ÉâË©≥Á¥∞:", record); // „Éá„Éê„ÉÉ„Ç∞Áî®
          
          // Êó•‰ªòÊñáÂ≠óÂàó„Çí„Éï„Ç©„Éº„Éû„ÉÉ„Éà (ISOÊñáÂ≠óÂàó„Åã„ÇâDate„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÁîüÊàê)
          let lendingDateStr = 'N/A';
          if (record.lendingDate && typeof record.lendingDate === 'string' && record.lendingDate !== 'Ôºà„É≠„Ç∞„Åã„ÇâÂæ©ÂÖÉÔºâ') {
            try {
              lendingDateStr = new Date(record.lendingDate).toLocaleString();
            } catch (e) { console.error("Ë≤∏Âá∫Êó•ÊôÇ„ÅÆ„Éë„Éº„Çπ„Ç®„É©„Éº:", e); }
          } else if (record.lendingDate === 'Ôºà„É≠„Ç∞„Åã„ÇâÂæ©ÂÖÉÔºâ') {
            lendingDateStr = record.lendingDate;
          }
          
          let dueDateStr = 'N/A';
           if (record.dueDate && typeof record.dueDate === 'string' && record.dueDate !== 'Ôºà„É≠„Ç∞„Åã„ÇâÂæ©ÂÖÉÔºâ') {
            try {
              dueDateStr = new Date(record.dueDate).toLocaleDateString(); // Êó•‰ªò„ÅÆ„ÅøË°®Á§∫
            } catch (e) { console.error("ËøîÂç¥‰∫àÂÆöÊó•„ÅÆ„Éë„Éº„Çπ„Ç®„É©„Éº:", e); }
          } else if (record.dueDate === 'Ôºà„É≠„Ç∞„Åã„ÇâÂæ©ÂÖÉÔºâ') {
            dueDateStr = record.dueDate;
          }
          
          // ËøîÂç¥Áä∂Ê≥Å„Å´Âøú„Åò„Åü„ÇØ„É©„Çπ„ÇíË®≠ÂÆö
          const statusClass = record.status === "ËøîÂç¥Ê∏à" ? "status-returned" : 
                             record.status === "Êú™ËøîÂç¥" ? "status-not-returned" : "";
          
          html += `
            <tr>
              <td>${record.bookId || 'N/A'}</td>
              <td>${record.bookTitle || 'N/A'}</td>
              <td>${record.userName || 'N/A'}<span class="user-id">ID: ${record.userId || 'N/A'}</span></td>
              <td>${lendingDateStr}</td>
              <td>${dueDateStr}</td>
              <td class="${statusClass}">${record.status || 'N/A'}</td>
            </tr>
          `;
        });
        
        html += `
            </tbody>
          </table>
        `;
        
        container.innerHTML = html;
        document.getElementById('rental-records').style.display = 'block';
      }

      // „Éì„Éº„ÉóÈü≥„ÇíÂÜçÁîü„Åô„ÇãÈñ¢Êï∞

      function setMessage(msg) {
        document.getElementById('message').innerText = msg;
      }

      // Êõ∏Á±çID„ÅåÊâãÂÖ•Âäõ„Åï„Çå„ÅüÂ†¥Âêà„Å´Enter„Ç≠„Éº„ÅßÊ§úÁ¥¢„ÇíÂÆüË°å
      document.getElementById('book-id').addEventListener('keypress', (event) => {
        if (event.key === 'Enter' && !isScanning) {
          searchRentalRecords();
        }
      });
      
      // Ê§úÁ¥¢„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
      document.getElementById('search-book-button').addEventListener('click', () => {
        if (!isScanning) {
          const bookId = document.getElementById('book-id').value.trim();
          if (bookId) {
            searchRentalRecords();
          } else {
            setMessage("Êõ∏Á±çID„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
          }
        }
      });

      // „Ç´„É°„É©Âàá„ÇäÊõø„ÅàÈñ¢Êï∞
      function switchCamera(viewportId) {
        // „Ç´„É°„É©„ÅÆÂêë„Åç„ÇíÂàá„ÇäÊõø„Åà
        currentFacingMode = currentFacingMode === "environment" ? "user" : "environment";
        
        // ÁèæÂú®„ÅÆ„Çπ„Ç≠„É£„Éä„Éº„ÇíÂÅúÊ≠¢
        stopScanner(viewportId);
        
        // ÂÖ•Âäõ„Éï„Ç£„Éº„É´„ÉâID„ÇíÂèñÂæó
        let inputFieldId = 'book-id';
        
        // Êñ∞„Åó„ÅÑ„Ç´„É°„É©Ë®≠ÂÆö„Åß„Çπ„Ç≠„É£„Éä„Éº„ÇíÂÜçËµ∑Âãï
        setTimeout(() => {
          startScanner(viewportId, inputFieldId);
        }, 300);
      }
    </script>
    <div class="menu-button-container"><a href="#" class="menu-button" id="menu-button-bottom">‚Üê „É°„Éã„É•„Éº„Å´Êàª„Çã</a></div>
    <script>
      // „É°„Éã„É•„Éº„Éú„Çø„É≥„ÅÆURL„ÇíË®≠ÂÆöÔºàÈ´òÈÄüÂåñÁâàÔºâ
      (function() {
        // URL„Çí„Ç≠„É£„ÉÉ„Ç∑„É•
        let cachedUrl = sessionStorage.getItem('webAppUrl');
        
        if (cachedUrl) {
          // „Ç≠„É£„ÉÉ„Ç∑„É•„Åå„ÅÇ„Çå„Å∞Âç≥Â∫ß„Å´Ë®≠ÂÆö
          document.getElementById('menu-button-top').href = cachedUrl;
          document.getElementById('menu-button-bottom').href = cachedUrl;
        } else {
          // „Ç≠„É£„ÉÉ„Ç∑„É•„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÂèñÂæó„Åó„Å¶„Ç≠„É£„ÉÉ„Ç∑„É•„Å´‰øùÂ≠ò
          google.script.run.withSuccessHandler(function(url) {
            sessionStorage.setItem('webAppUrl', url);
            document.getElementById('menu-button-top').href = url;
            document.getElementById('menu-button-bottom').href = url;
          }).getWebAppUrl();
        }
      })();
      
      // „Éñ„É©„Ç¶„Ç∂„ÅÆÊàª„Çã„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
      window.history.pushState(null, null, window.location.href);
      window.addEventListener('popstate', function(event) {
        window.history.pushState(null, null, window.location.href);
      });
    </script>
  </body>
</html>
