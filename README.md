# 図書館管理システム v6 使い方マニュアル

Google Apps Script（GAS）で作成された、シンプルで使いやすい図書館管理システムです。バーコードスキャン機能により、スマートフォンやタブレットで簡単に書籍の貸出・返却ができます。

## 目次

1. [システムの特徴](#システムの特徴)
2. [初期設定](#初期設定)
3. [基本的な使い方](#基本的な使い方)
4. [各機能の詳細](#各機能の詳細)
5. [トラブルシューティング](#トラブルシューティング)
6. [技術仕様](#技術仕様)

## システムの特徴

- 📱 **モバイル対応**: スマートフォン・タブレットで快適に操作可能
- 📷 **バーコードスキャン**: カメラでバーコードを読み取って簡単入力
- 🔄 **リアルタイム管理**: Googleスプレッドシートと連携してリアルタイムで情報更新
- 🎯 **シンプルな操作**: 大きなボタンとわかりやすい画面構成
- 🌐 **どこからでもアクセス**: インターネット接続があればどこからでも利用可能

## 初期設定

### 1. Googleスプレッドシートの準備

1. 以下のURLからスプレッドシートをコピーしてください：
   ```
   https://docs.google.com/spreadsheets/d/1K6BuAkF2YVc_M7ICAgdNMnws0TN89_80IFpVd9-rlwA/copy
   ```

2. 「コピーを作成」をクリックして、自分のGoogleドライブにコピーを保存します。

3. コピーしたスプレッドシートには以下の3つのシートが含まれています：
   - **書籍DB**: 書籍情報を管理
   - **利用者DB**: 利用者情報を管理
   - **貸出記録**: 貸出・返却の履歴を管理

### 2. Google Apps Scriptのセットアップ

1. Googleドライブで新しいGoogle Apps Scriptプロジェクトを作成
2. 本リポジトリのコードをコピー
3. `appsscript.json`の`exceptionLogging`を`"STACKDRIVER"`に設定（エラーログ記録用）

### 3. ウェブアプリとしてデプロイ

1. GASエディタで「デプロイ」→「新しいデプロイ」を選択
2. 種類：「ウェブアプリ」を選択
3. 実行ユーザー：「自分」
4. アクセスできるユーザー：「全員」（または組織内のみ）
5. デプロイをクリックしてURLを取得

## 基本的な使い方

### メニュー画面

システムにアクセスすると、以下の5つの機能が表示されます：

1. **📚 図書貸出**: 書籍を貸し出す
2. **📖 図書返却**: 書籍を返却する
3. **🔍 貸出書籍検索**: 現在貸出中の書籍を検索
4. **👤 利用者別返却**: 特定の利用者が借りている書籍をまとめて返却
5. **➕ 書籍登録**: 新しい書籍を登録

### バーコードスキャンの使い方

1. 「スキャン」ボタンをタップ
2. カメラへのアクセスを許可
3. 緑色の枠内にバーコードを合わせる
4. 読み取りが完了すると自動的に入力される
5. 「✕ 閉じる」ボタンでカメラを終了

## 各機能の詳細

### 📚 図書貸出

1. **利用者IDを入力**
   - バーコードスキャンまたは手入力
   - 検索ボタンで利用者名を確認

2. **書籍IDを入力**（複数可）
   - バーコードスキャンで連続読み取り可能
   - 読み取った書籍がリストに表示される

3. **貸出処理**
   - 「貸出」ボタンをクリック
   - 貸出期限は自動的に2週間後に設定

### 📖 図書返却

1. **書籍IDを入力**
   - バーコードスキャンまたは手入力
   - 複数の書籍をまとめて返却可能

2. **返却処理**
   - チェックボックスで返却する書籍を選択
   - 「選択した本をまとめて返却」ボタンをクリック

### 🔍 貸出書籍検索

- 書籍IDを入力して、現在の貸出状況を確認
- 貸出中の場合は利用者情報と返却予定日が表示される

### 👤 利用者別返却

1. **利用者IDを入力**
   - その利用者が借りている全書籍が表示される

2. **一括返却**
   - 返却する書籍を選択
   - まとめて返却処理が可能

### ➕ 書籍登録

1. **ISBNコードをスキャン**
   - 自動的に書籍情報を取得（対応している場合）

2. **書籍情報を入力**
   - 書籍ID（バーコード）
   - 書籍名
   - その他の情報（任意）

3. **登録**
   - 「登録」ボタンで書籍DBに追加

## トラブルシューティング

### カメラが起動しない
- ブラウザの設定でカメラへのアクセスを許可してください
- HTTPSでアクセスしているか確認してください

### バーコードが読み取れない
- 明るい場所で撮影してください
- バーコードを緑色の枠内に収めてください
- カメラのフォーカスが合うまで待ってください

### エラーが表示される
- インターネット接続を確認してください
- Googleスプレッドシートへのアクセス権限を確認してください

## 技術仕様

### 使用技術
- Google Apps Script (GAS)
- HTML5 / CSS3 / JavaScript
- QuaggaJS（バーコードスキャンライブラリ）
- Google Sheets API

### ブラウザ対応
- Chrome（推奨）
- Safari
- Firefox
- Edge

### モバイル対応
- iOS（iPhone/iPad）
- Android

### データ形式
- 書籍ID: バーコード番号
- 利用者ID: 任意の識別番号
- 日付: YYYY/MM/DD HH:mm:ss形式

## データベース構造

### 書籍DB
| 列 | フィールド名 | 説明 |
|---|------------|-----|
| A | 書籍ID | 書籍の一意識別子（バーコード） |
| B | 書籍名 | 書籍のタイトル |

### 利用者DB
| 列 | フィールド名 | 説明 |
|---|------------|-----|
| A | 利用者ID | 利用者の一意識別子 |
| B | 利用者名 | 利用者の氏名 |
| C | メールアドレス | 連絡先メールアドレス |

### 貸出記録
| 列 | フィールド名 | 説明 |
|---|------------|-----|
| A | 書籍ID | 貸出書籍のID |
| B | 書籍名 | 貸出書籍のタイトル |
| C | 利用者ID | 借りた利用者のID |
| D | 利用者名 | 借りた利用者の氏名 |
| E | 貸出日時 | 貸出した日時 |
| F | 返却予定日 | 返却予定日（2週間後） |
| G | 返却状況 | "未返却" または "返却済み" |
| H | 返却日時 | 実際の返却日時 |

## 開発者向け情報

### CLASPを使った開発

```bash
# 依存関係のインストール
npm install

# Google Apps Scriptにログイン
npx clasp login

# コードをGASにアップロード
npx clasp push

# GASからコードをダウンロード
npx clasp pull

# Apps Scriptエディタを開く
npx clasp open-script

# ログを確認
npx clasp logs
```

### ファイル構成

```
├── コード.js           # バックエンドロジック
├── menu.html          # メニューページ
├── lending.html       # 貸出ページ
├── returning.html     # 返却ページ
├── rental_books_finder.html  # 検索ページ
├── user_returns.html  # 利用者別返却ページ
├── book_register.html # 書籍登録ページ
├── appsscript.json   # GAS設定ファイル
├── .clasp.json       # CLASPプロジェクト設定
├── package.json      # Node.js設定
└── README.md         # このファイル
```

## セキュリティとプライバシー

- すべてのデータはGoogleスプレッドシートに保存されます
- アクセス権限はGoogleアカウントで管理されます
- カメラは使用時のみアクセスされます
- HTTPSでホストされている必要があります

## サポート

問題が発生した場合は、以下を確認してください：
1. ブラウザのコンソールログ（F12キー）
2. Google Apps Scriptの実行ログ
3. Googleスプレッドシートのデータ整合性

## ライセンス

このプロジェクトは[MIT License](LICENSE)の下で公開されています。

---

最終更新日: 2025年6月
バージョン: 6.0